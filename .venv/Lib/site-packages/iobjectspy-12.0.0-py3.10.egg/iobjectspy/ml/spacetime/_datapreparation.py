#!/usr/bin/env python3
# coding=utf-8
import os
from iobjectspy._jsuperpy._utils import check_lic
from ._sample.create_graph_st_adjmx import CreateGraphST_AdjMX
from ._sample.create_graph_st_regression_data import CreateGraphST_RegressionData
from ..toolkit._toolkit import del_dir

class DataPreparation:
    """
    图时空预测数据准备流程入口

    """
    @staticmethod
    def create_training_data(
        input_data,
        output_dir=None,
        train_rate=0.7,
        test_rate=0.2,
        index_col="0",
        period_len=3,
        step_rows=12,
        period_steps=24,
        period_units="D",add_time_in_period=True

    ):
        """
        训练数据生成

        :param input_data: 输入的原始表格数据路径，支持csv格式。表格中每列表示各位置点的数据，每行表示一个时间时刻。
        :type input_data: str
        :param output_dir: 生成训练集，测试集等数据的输出目录。
        :type output_dir: str
        :param train_rate: 用于生成训练集的比例,默认0.7
        :type train_rate: float
        :param test_rate: 用于生成训练集的比例,默认0.2
        :type test_rate: float
        :param index_col: 时间索引列的序号,默认为"0"
        :type index_col: str or int
        :param period_len: 时间周期特征的长度,默认为3
        :type period_len: int
        :param step_rows: 一个时间步长包括的行数，默认为12
        :type step_rows: int
        :param period_steps: 一个时间周期包括的时间步长，默认为24
        :type period_steps: int
        :param period_units: 时间周期的单位，默认为"D"，表示天
        :type period_units: str
        :param add_time_in_period: 是否增加周期性特征，默认为True
        :param add_time_in_period: bool
        """

        check_lic()
        create_train_data = CreateGraphST_RegressionData(
            input_data=input_data,
            output_dir=output_dir,
            index_col=index_col,
            train_rate=train_rate,
            test_rate=test_rate
        )
        create_train_data.create_training_data(
            period_len=period_len,
            step_rows=step_rows,
            period_steps=period_steps,
            period_units=period_units,
            add_time_in_period=add_time_in_period
        )


    @staticmethod
    def create_adj_mx(input_pts_coords,
                      output_dir,
                      id_col="0", long_col="1", lat_col="2",
                      dist_file=None
                      ):
        """邻接矩阵生成

        :param input_pts_coords: 输入点数据的坐标文件
        :type input_pts_coords: str
        :param output_dir: 生成邻接矩阵的输出目录
        :type output_dir: str
        :param id_col: id序号的列序号，默认为"0"
        :type id_col: id序号的列序号，默认为"0"
        :param long_col: 经度列的列序号，默认为"1"
        :type long_col: str
        :param lat_col: 纬度列的列序号，默认为"2"
        :type lat_col: str
        :param dist_file: 给定的距离信息文件路径，包含每条结点对 (from结点和to结点)的id,以及节点对之间的距离
        :type dist_file: str
        """

        check_lic()
        create_adj = CreateGraphST_AdjMX(
        )
        create_adj.create_adj_matrix_pkl(
            input_pts_coords=input_pts_coords,
            dist_file=dist_file,
            output_dir = output_dir,
            id_col=id_col, long_col=long_col, lat_col=lat_col
        )
