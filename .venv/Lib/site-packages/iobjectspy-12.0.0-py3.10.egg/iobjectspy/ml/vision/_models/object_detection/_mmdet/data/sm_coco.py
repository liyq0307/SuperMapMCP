# Copyright (c) OpenMMLab. All rights reserved.
import shapely.speedups
shapely.speedups.disable()
import os
from mmdet.registry import DATASETS
from mmdet.datasets.coco import CocoDataset
from iobjectspy.ml.vision._models.object_detection._mmdet._tools import vocmask2coco


@DATASETS.register_module()
class SMCocoDataset(CocoDataset):
    def __init__(self, **kwargs):

        json_list = ['train.json', 'val.json']
        for json_name in json_list:
            if not os.path.exists(os.path.join(kwargs.get('data_root'), json_name)):
                vocmask2coco(kwargs.get('data_root'),
                            kwargs.get('metainfo').classes,
                            json_name=json_name)
        del kwargs['model_type']
        super(SMCocoDataset, self).__init__(**kwargs)
