# !/usr/bin/env python3
# coding=utf-8
import os

from ...toolkit._toolkit import get_config_from_yaml
from .._models.image_classification import ClassificationEstimation


class ObjectClassification:
    def __init__(self, model_path, gpus, batch_size):
        self.model_path = os.path.abspath(os.path.join(model_path, os.path.pardir))
        self.config = get_config_from_yaml(model_path)
        self.gpus = gpus
        self.batch_size = batch_size

    def infer(self, input_data, input_corres_region, field_name, **kwargs):

        func_str = 'self.' + self.config.model_architecture + '_' + self.config.framework
        result = eval(func_str)(input_data, input_corres_region, field_name, **kwargs)

        if isinstance(result, str):
            print('\nThe results of classify \'{}\' have been saved to \'{}\'!'.format(field_name,result))

        return result

    def cnn_pytorch(self, input_data, input_corres_region, field_name, **kwargs):
        return ClassificationEstimation(self.model_path, self.config, self.gpus, self.batch_size).estimate_corregion_img(input_data,
                                                                                input_corres_region, field_name, **kwargs)
